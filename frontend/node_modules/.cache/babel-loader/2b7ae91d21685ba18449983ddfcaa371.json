{"ast":null,"code":"var _jsxFileName = \"/home/hitsuri/blog-post-final/frontend/src/App.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { API_URL } from './api';\nimport NavBar from './components/';\nimport { News } from './components/';\nimport { maxOffsetThunk, someThunk, setOffset, reset, setLastPostsNumber } from './redux/action/news';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction App() {\n  _s();\n\n  const dispatch = useDispatch();\n  const [actualOffset, setActualOffset] = useState(0);\n  const [maxOffset, setMaxOffset] = useState(0);\n  const [loading, setLoading] = useState(0);\n  const lastPostsNumber = useSelector(state => state.news.totalPosts);\n  const actualReduxOffset = useSelector(state => state.news.actualOffset);\n  const allNews = useSelector(state => state.news.allNews);\n  const actualReduxMaxOffset = useSelector(state => state.news.maxOffset);\n\n  async function getMaxPosts() {\n    try {\n      const rawData = await fetch(API_URL + 'post/count', {\n        method: 'GET'\n      });\n      const total = await rawData.json();\n      return total;\n    } catch (e) {\n      console.log('erro ao carregar');\n    }\n  }\n\n  function checkIfExists(e, actualOffset, maxOffset) {\n    const {\n      scrollHeight,\n      scrollTop,\n      clientHeight\n    } = document.documentElement;\n\n    if (clientHeight + scrollTop >= scrollHeight) {\n      if (actualOffset <= maxOffset * 6) {\n        setLoading(true);\n      }\n\n      return false;\n    }\n  }\n\n  useEffect(() => {\n    if (actualOffset <= maxOffset * 6 && loading) {\n      dispatch(someThunk(actualOffset));\n      dispatch(setOffset(actualOffset));\n      setLoading(false);\n    }\n  }, [loading]);\n  useEffect(() => {\n    window.addEventListener('scroll', e => checkIfExists(e, actualOffset, maxOffset));\n    return window.removeEventListener('scroll', e => checkIfExists(e, actualOffset, maxOffset));\n  }, []);\n  useEffect(() => {\n    if (allNews.length < 1) {\n      getMaxPosts().then(res => {\n        dispatch(someThunk(actualOffset));\n        dispatch(maxOffsetThunk());\n        dispatch(setOffset(actualOffset));\n        dispatch(setLastPostsNumber(res));\n      }).catch(() => dispatch(someThunk(0)));\n    }\n  }, []);\n  useEffect(() => {\n    if (allNews.length > 1) {\n      getMaxPosts().then(total => {\n        if (total > lastPostsNumber && lastPostsNumber !== 0) {\n          dispatch(someThunk(0));\n          dispatch(reset());\n          dispatch(maxOffsetThunk());\n          dispatch(setOffset(0));\n        }\n      });\n    }\n  }, [lastPostsNumber]);\n  useEffect(() => {\n    setActualOffset(actualReduxOffset);\n    setMaxOffset(actualReduxMaxOffset);\n  }, [actualReduxMaxOffset, actualReduxOffset]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"app\",\n    children: [/*#__PURE__*/_jsxDEV(\"header\", {\n      className: \"app-header\",\n      children: /*#__PURE__*/_jsxDEV(NavBar, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      className: \"app-news-section\",\n      children: [/*#__PURE__*/_jsxDEV(News, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"app-news-section-side\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"7IAyhNt4Ia/5rOJJUN8fG4kD2jw=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector, useSelector];\n});\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","API_URL","NavBar","News","maxOffsetThunk","someThunk","setOffset","reset","setLastPostsNumber","App","dispatch","actualOffset","setActualOffset","maxOffset","setMaxOffset","loading","setLoading","lastPostsNumber","state","news","totalPosts","actualReduxOffset","allNews","actualReduxMaxOffset","getMaxPosts","rawData","fetch","method","total","json","e","console","log","checkIfExists","scrollHeight","scrollTop","clientHeight","document","documentElement","window","addEventListener","removeEventListener","length","then","res","catch"],"sources":["/home/hitsuri/blog-post-final/frontend/src/App.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { API_URL } from './api';\nimport NavBar from './components/';\nimport { News } from './components/';\nimport {\n  maxOffsetThunk,\n  someThunk,\n  setOffset,\n  reset,\n  setLastPostsNumber,\n} from './redux/action/news';\n\nfunction App() {\n  const dispatch = useDispatch();\n  const [actualOffset, setActualOffset] = useState(0);\n  const [maxOffset, setMaxOffset] = useState(0);\n  const [loading, setLoading] = useState(0);\n  const lastPostsNumber = useSelector((state) => state.news.totalPosts);\n  const actualReduxOffset = useSelector((state) => state.news.actualOffset);\n  const allNews = useSelector((state) => state.news.allNews);\n  const actualReduxMaxOffset = useSelector((state) => state.news.maxOffset);\n\n  async function getMaxPosts() {\n    try {\n      const rawData = await fetch(API_URL + 'post/count', {\n        method: 'GET',\n      });\n      const total = await rawData.json();\n      return total;\n    } catch(e) {\n      console.log('erro ao carregar')\n    }\n  }\n\n  function checkIfExists(e, actualOffset, maxOffset) {\n    const { scrollHeight, scrollTop, clientHeight } = document.documentElement;\n    if (clientHeight + scrollTop >= scrollHeight) {\n      if (actualOffset <= maxOffset * 6) {\n        setLoading(true);\n      }\n      return false;\n    }\n  }\n\n  useEffect(() => {\n    if (actualOffset <= maxOffset * 6 && loading) {\n      dispatch(someThunk(actualOffset));\n      dispatch(setOffset(actualOffset));\n      setLoading(false);\n    }\n  }, [loading]);\n\n  useEffect(() => {\n    window.addEventListener('scroll', (e) =>\n      checkIfExists(e, actualOffset, maxOffset)\n    );\n\n    return window.removeEventListener('scroll', (e) =>\n      checkIfExists(e, actualOffset, maxOffset)\n    );\n  }, []);\n\n  useEffect(() => {\n    if (allNews.length < 1) {\n      getMaxPosts().then((res) => {\n        dispatch(someThunk(actualOffset));\n        dispatch(maxOffsetThunk());\n        dispatch(setOffset(actualOffset));\n        dispatch(setLastPostsNumber(res));\n      })\n      .catch(() => dispatch(someThunk(0)));\n    }\n  }, []);\n\n  useEffect(() => {\n    if (allNews.length > 1) {\n      getMaxPosts().then((total) => {\n        if (total > lastPostsNumber && lastPostsNumber !== 0) {\n          dispatch(someThunk(0));\n          dispatch(reset());\n          dispatch(maxOffsetThunk());\n          dispatch(setOffset(0));\n        }\n      });\n    }\n  }, [lastPostsNumber]);\n\n  useEffect(() => {\n    setActualOffset(actualReduxOffset);\n    setMaxOffset(actualReduxMaxOffset);\n  }, [actualReduxMaxOffset, actualReduxOffset]);\n\n  return (\n    <div className=\"app\">\n      <header className=\"app-header\">\n        <NavBar />\n      </header>\n      <section className=\"app-news-section\">\n        <News />\n        <div className='app-news-section-side'>\n        </div>\n      </section>\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":";;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,WAAT,EAAsBC,WAAtB,QAAyC,aAAzC;AACA,SAASC,OAAT,QAAwB,OAAxB;AACA,OAAOC,MAAP,MAAmB,eAAnB;AACA,SAASC,IAAT,QAAqB,eAArB;AACA,SACEC,cADF,EAEEC,SAFF,EAGEC,SAHF,EAIEC,KAJF,EAKEC,kBALF,QAMO,qBANP;;;AAQA,SAASC,GAAT,GAAe;EAAA;;EACb,MAAMC,QAAQ,GAAGX,WAAW,EAA5B;EACA,MAAM,CAACY,YAAD,EAAeC,eAAf,IAAkCd,QAAQ,CAAC,CAAD,CAAhD;EACA,MAAM,CAACe,SAAD,EAAYC,YAAZ,IAA4BhB,QAAQ,CAAC,CAAD,CAA1C;EACA,MAAM,CAACiB,OAAD,EAAUC,UAAV,IAAwBlB,QAAQ,CAAC,CAAD,CAAtC;EACA,MAAMmB,eAAe,GAAGjB,WAAW,CAAEkB,KAAD,IAAWA,KAAK,CAACC,IAAN,CAAWC,UAAvB,CAAnC;EACA,MAAMC,iBAAiB,GAAGrB,WAAW,CAAEkB,KAAD,IAAWA,KAAK,CAACC,IAAN,CAAWR,YAAvB,CAArC;EACA,MAAMW,OAAO,GAAGtB,WAAW,CAAEkB,KAAD,IAAWA,KAAK,CAACC,IAAN,CAAWG,OAAvB,CAA3B;EACA,MAAMC,oBAAoB,GAAGvB,WAAW,CAAEkB,KAAD,IAAWA,KAAK,CAACC,IAAN,CAAWN,SAAvB,CAAxC;;EAEA,eAAeW,WAAf,GAA6B;IAC3B,IAAI;MACF,MAAMC,OAAO,GAAG,MAAMC,KAAK,CAACzB,OAAO,GAAG,YAAX,EAAyB;QAClD0B,MAAM,EAAE;MAD0C,CAAzB,CAA3B;MAGA,MAAMC,KAAK,GAAG,MAAMH,OAAO,CAACI,IAAR,EAApB;MACA,OAAOD,KAAP;IACD,CAND,CAME,OAAME,CAAN,EAAS;MACTC,OAAO,CAACC,GAAR,CAAY,kBAAZ;IACD;EACF;;EAED,SAASC,aAAT,CAAuBH,CAAvB,EAA0BnB,YAA1B,EAAwCE,SAAxC,EAAmD;IACjD,MAAM;MAAEqB,YAAF;MAAgBC,SAAhB;MAA2BC;IAA3B,IAA4CC,QAAQ,CAACC,eAA3D;;IACA,IAAIF,YAAY,GAAGD,SAAf,IAA4BD,YAAhC,EAA8C;MAC5C,IAAIvB,YAAY,IAAIE,SAAS,GAAG,CAAhC,EAAmC;QACjCG,UAAU,CAAC,IAAD,CAAV;MACD;;MACD,OAAO,KAAP;IACD;EACF;;EAEDnB,SAAS,CAAC,MAAM;IACd,IAAIc,YAAY,IAAIE,SAAS,GAAG,CAA5B,IAAiCE,OAArC,EAA8C;MAC5CL,QAAQ,CAACL,SAAS,CAACM,YAAD,CAAV,CAAR;MACAD,QAAQ,CAACJ,SAAS,CAACK,YAAD,CAAV,CAAR;MACAK,UAAU,CAAC,KAAD,CAAV;IACD;EACF,CANQ,EAMN,CAACD,OAAD,CANM,CAAT;EAQAlB,SAAS,CAAC,MAAM;IACd0C,MAAM,CAACC,gBAAP,CAAwB,QAAxB,EAAmCV,CAAD,IAChCG,aAAa,CAACH,CAAD,EAAInB,YAAJ,EAAkBE,SAAlB,CADf;IAIA,OAAO0B,MAAM,CAACE,mBAAP,CAA2B,QAA3B,EAAsCX,CAAD,IAC1CG,aAAa,CAACH,CAAD,EAAInB,YAAJ,EAAkBE,SAAlB,CADR,CAAP;EAGD,CARQ,EAQN,EARM,CAAT;EAUAhB,SAAS,CAAC,MAAM;IACd,IAAIyB,OAAO,CAACoB,MAAR,GAAiB,CAArB,EAAwB;MACtBlB,WAAW,GAAGmB,IAAd,CAAoBC,GAAD,IAAS;QAC1BlC,QAAQ,CAACL,SAAS,CAACM,YAAD,CAAV,CAAR;QACAD,QAAQ,CAACN,cAAc,EAAf,CAAR;QACAM,QAAQ,CAACJ,SAAS,CAACK,YAAD,CAAV,CAAR;QACAD,QAAQ,CAACF,kBAAkB,CAACoC,GAAD,CAAnB,CAAR;MACD,CALD,EAMCC,KAND,CAMO,MAAMnC,QAAQ,CAACL,SAAS,CAAC,CAAD,CAAV,CANrB;IAOD;EACF,CAVQ,EAUN,EAVM,CAAT;EAYAR,SAAS,CAAC,MAAM;IACd,IAAIyB,OAAO,CAACoB,MAAR,GAAiB,CAArB,EAAwB;MACtBlB,WAAW,GAAGmB,IAAd,CAAoBf,KAAD,IAAW;QAC5B,IAAIA,KAAK,GAAGX,eAAR,IAA2BA,eAAe,KAAK,CAAnD,EAAsD;UACpDP,QAAQ,CAACL,SAAS,CAAC,CAAD,CAAV,CAAR;UACAK,QAAQ,CAACH,KAAK,EAAN,CAAR;UACAG,QAAQ,CAACN,cAAc,EAAf,CAAR;UACAM,QAAQ,CAACJ,SAAS,CAAC,CAAD,CAAV,CAAR;QACD;MACF,CAPD;IAQD;EACF,CAXQ,EAWN,CAACW,eAAD,CAXM,CAAT;EAaApB,SAAS,CAAC,MAAM;IACde,eAAe,CAACS,iBAAD,CAAf;IACAP,YAAY,CAACS,oBAAD,CAAZ;EACD,CAHQ,EAGN,CAACA,oBAAD,EAAuBF,iBAAvB,CAHM,CAAT;EAKA,oBACE;IAAK,SAAS,EAAC,KAAf;IAAA,wBACE;MAAQ,SAAS,EAAC,YAAlB;MAAA,uBACE,QAAC,MAAD;QAAA;QAAA;QAAA;MAAA;IADF;MAAA;MAAA;MAAA;IAAA,QADF,eAIE;MAAS,SAAS,EAAC,kBAAnB;MAAA,wBACE,QAAC,IAAD;QAAA;QAAA;QAAA;MAAA,QADF,eAEE;QAAK,SAAS,EAAC;MAAf;QAAA;QAAA;QAAA;MAAA,QAFF;IAAA;MAAA;MAAA;MAAA;IAAA,QAJF;EAAA;IAAA;IAAA;IAAA;EAAA,QADF;AAYD;;GA5FQZ,G;UACUV,W,EAIOC,W,EACEA,W,EACVA,W,EACaA,W;;;KARtBS,G;AA8FT,eAAeA,GAAf"},"metadata":{},"sourceType":"module"}